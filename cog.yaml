build:
  gpu: true
  cuda: "11.8"
  system_packages:
    - "libgl1-mesa-glx"
    - "libglib2.0-0"
    - "libsm6"
    - "libxext6"
    - "libxrender-dev"
    - "libgomp1"
    - "wget"
    - "curl"
    - "git"
    - "cmake"
    - "build-essential"
    - "libboost-all-dev"
    - "pkg-config"
  python_version: "3.10"
  python_packages:
    - "torch==2.0.1"
    - "torchvision==0.15.2"
    - "torchaudio==2.0.2"
    - "torchtext==0.15.2"
    - "xformers==0.0.20"
    - "accelerate"
    - "transformers"
    - "diffusers"
    - "opencv-python"
    - "pillow"
    - "numpy"
    - "requests"
    - "aiohttp"
    - "pyyaml"
    - "Pillow"
    - "scipy"
    - "tqdm"
    - "psutil"
  run:
    - "git clone https://github.com/comfyanonymous/ComfyUI.git"
    - "cd ComfyUI && pip install -r requirements.txt"
    - "cd ComfyUI/custom_nodes && git clone https://github.com/cubiq/PuLID_ComfyUI.git"
    - "cd ComfyUI/custom_nodes && git clone https://codeberg.org/Gourieff/comfyui-reactor-node.git"
    - "cd ComfyUI/custom_nodes && git clone https://github.com/Fannovel16/comfyui_controlnet_aux.git"
    - "cd ComfyUI/custom_nodes && git clone https://github.com/kijai/ComfyUI-FluxTrainer.git"
    - "pip install insightface onnxruntime-gpu"
    - "pip install dlib"
    - "pip install face-recognition opencv-contrib-python"
    - "mkdir -p ComfyUI/models/checkpoints"
    - "mkdir -p ComfyUI/models/vae"
    - "mkdir -p ComfyUI/models/clip"
    - "mkdir -p ComfyUI/models/controlnet"
    - "mkdir -p ComfyUI/models/pulid"
    - "mkdir -p ComfyUI/models/insightface"
    - "mkdir -p ComfyUI/models/facerestore_models"
    - "wget -O ComfyUI/models/checkpoints/flux1DevFp8_v10.safetensors https://huggingface.co/Kijai/flux-fp8/resolve/main/flux1-dev-fp8.safetensors"
    - "wget -O ComfyUI/models/vae/ae.sft https://huggingface.co/black-forest-labs/FLUX.1-dev/resolve/main/ae.safetensors"
    - "wget -O ComfyUI/models/clip/clip_l.safetensors https://huggingface.co/comfyanonymous/flux_text_encoders/resolve/main/clip_l.safetensors"
    - "wget -O ComfyUI/models/clip/t5xxl_fp8_e4m3fn.safetensors https://huggingface.co/comfyanonymous/flux_text_encoders/resolve/main/t5xxl_fp8_e4m3fn.safetensors"
    - "wget -O ComfyUI/models/controlnet/flux-depth-controlnet-v3.safetensors https://huggingface.co/Shakker-Labs/FLUX.1-dev-ControlNet-Depth/resolve/main/diffusion_pytorch_model.safetensors"
    - "wget -O ComfyUI/models/pulid/pulid_flux_v0.9.1.safetensors https://huggingface.co/guozinan/PuLID/resolve/main/pulid_flux_v0.9.1.safetensors"
    - "wget -O ComfyUI/models/insightface/inswapper_128.onnx https://huggingface.co/MonsterMMORPG/tools/resolve/main/inswapper_128.onnx"
    - "wget -O ComfyUI/models/facerestore_models/GFPGANv1.4.pth https://github.com/TencentARC/GFPGAN/releases/download/v1.3.0/GFPGANv1.4.pth"

predict: "predict.py:Predictor" 