build:
  gpu: true
  cuda: "11.8"
  system_packages:
    - "libgl1-mesa-glx"
    - "libglib2.0-0"
    - "libsm6"
    - "libxext6"
    - "libxrender-dev"
    - "libgomp1"
    - "wget"
    - "curl"
    - "git"
    - "cmake"
    - "build-essential"
    - "libboost-all-dev"
    - "pkg-config"
  python_version: "3.10"
  python_packages:
    - "torch==2.0.1"
    - "torchvision==0.15.2"
    - "torchaudio==2.0.2"
    - "torchtext==0.15.2"
    - "xformers==0.0.20"
    - "accelerate"
    - "transformers"
    - "diffusers"
    - "opencv-python"
    - "pillow"
    - "numpy"
    - "requests"
    - "aiohttp"
    - "pyyaml"
    - "Pillow"
    - "scipy"
    - "tqdm"
    - "psutil"
    - "fastapi==0.104.1"
    - "pydantic==2.4.2"
  run:
    - "git clone https://github.com/comfyanonymous/ComfyUI.git"
    - "cd ComfyUI && pip install -r requirements.txt"
    - "cd ComfyUI/custom_nodes && git clone https://github.com/cubiq/PuLID_ComfyUI.git"
    - "cd ComfyUI/custom_nodes && git clone https://codeberg.org/Gourieff/comfyui-reactor-node.git"
    - "cd ComfyUI/custom_nodes && git clone https://github.com/Fannovel16/comfyui_controlnet_aux.git"
    - "cd ComfyUI/custom_nodes && git clone https://github.com/kijai/ComfyUI-FluxTrainer.git"
    - "pip install insightface onnxruntime-gpu"
    - "pip install dlib"
    - "pip install face-recognition opencv-contrib-python"
    - "mkdir -p ComfyUI/models/checkpoints"
    - "mkdir -p ComfyUI/models/vae"
    - "mkdir -p ComfyUI/models/clip"
    - "mkdir -p ComfyUI/models/controlnet"
    - "mkdir -p ComfyUI/models/pulid"
    - "mkdir -p ComfyUI/models/insightface"
    - "mkdir -p ComfyUI/models/facerestore_models"

predict: "predict.py:Predictor" 